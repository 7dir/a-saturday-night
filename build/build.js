!function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){i(1),i(3),i(4),i(5),i(6),i(7),i(8),i(9),i(10),i(11),i(12),i(13),i(14),i(15)},function(t,e,i){var n=i(2).getUrlParams;window.addEventListener("load",function(t){var e=document.getElementById("instructions"),i=document.getElementById("asaturday-ui"),a=document.querySelector("#asaturday-ui .share"),s=document.getElementById("asaturday-share-url"),o=document.querySelector("#asaturday-ui .progress"),r=document.querySelector("#asaturday-ui .bar"),l=document.querySelector("a-scene"),c=n();c.url||e.classList.remove("hide"),l.addEventListener("enter-vr",function(){e.classList.add("hide")}),document.addEventListener("uploadcare-upload-completed",function(t){a.classList.remove("hide"),o.classList.add("hide"),s.value=t.detail.url}),document.addEventListener("uploadcare-upload-started",function(t){i.classList.remove("hide"),a.classList.add("hide"),o.classList.remove("hide")}),document.addEventListener("uploadcare-upload-progress",function(t){r.style.width=Math.floor(100*t.detail.progress)+"%"});var d=new Clipboard(".button.copy");d.on("error",function(t){console.error("Error copying to clipboard:",t.action,t.trigger)})})},function(t,e){function i(){var t,e=/\+/g,i=/([^&=]+)=?([^&]*)/g,n=function(t){return decodeURIComponent(t.replace(e," "))},a=window.location.search.substring(1),s={};for(t=i.exec(a);t;)s[n(t[1])]=n(t[2]),t=i.exec(a);return s}t.exports={getUrlParams:i}},function(t,e){AFRAME.registerComponent("proxy-event",{schema:{event:{default:""},dst:{type:"selector"},bubbles:{default:!1}},init:function(){var t=this.data.dst||this.el;this.el.sceneEl.addEventListener(this.data.event,function(e){t.emit(this.data.event,e,this.data.bubbles)}.bind(this))}})},function(t,e){AFRAME.registerComponent("aabb-collider",{schema:{objects:{default:""},state:{default:"collided"}},init:function(){this.els=[],this.collisions=[],this.elMax=new THREE.Vector3,this.elMin=new THREE.Vector3},update:function(){var t,e=this.data;t=e.objects?this.el.sceneEl.querySelectorAll(e.objects):this.el.sceneEl.children,this.els=Array.prototype.slice.call(t)},tick:function(){var t=new THREE.Box3;return function(){function e(e){var i,n,s,o=e.getObject3D("mesh");o&&(t.setFromObject(o),n=t.min,s=t.max,i=r.elMin.x<=s.x&&r.elMax.x>=n.x&&r.elMin.y<=s.y&&r.elMax.y>=n.y&&r.elMin.z<=s.z&&r.elMax.z>=n.z,i&&a.push(e))}function i(t){t.emit("hit"),t.addState(r.data.state),r.el.emit("hit",{el:t})}function n(){t.setFromObject(o),r.elMin.copy(t.min),r.elMax.copy(t.max)}var a=[],s=this.el,o=s.getObject3D("mesh"),r=this;o&&(n(),this.els.forEach(e),a.forEach(i),0===a.length&&r.el.emit("hit",{el:null}),this.collisions.filter(function(t){return a.indexOf(t)===-1}).forEach(function(t){t.removeState(r.data.state)}),this.collisions=a)}}()})},function(t,e){AFRAME.registerComponent("game-state",{schema:{selectedAvatar:{type:"selector"},countdownTime:{default:3},dancingTime:{default:5},state:{default:"intro",oneOf:["intro","avatar-selection","countdown","dancing","collect-url"]}},init:function(){this.updateState=this.updateState.bind(this)},play:function(){this.el.addEventListener("enter-vr",this.updateState)},pause:function(){this.el.removeEventListener("enter-vr",this.updateState)},update:function(t){var e=this.data;this.el;return t.state!==e.state?void this.setState(e.state):void this.updateState()},updateState:function(){var t=this.el,e=this.data;switch(e.state){case"intro":if(!this.el.is("vr-mode"))return;t.setAttribute("game-state","state","avatar-selection");break;case"avatar-selection":if(!e.selectedAvatar)return;t.setAttribute("game-state","state","countdown");break;case"countdown":if(e.countdownTime>0)return;t.setAttribute("game-state","state","dancing"),t.emit("dancing");break;case"dancing":if(e.dancingTime>0)return;t.setAttribute("game-state","state","collect-url");break;case"collect-url":break;default:console.log("Unknown state "+e.state)}},setState:function(t){var e=this.el,i=this.schema.state.oneOf;this.updatingState||(i.indexOf(t)===-1&&console.log("Unknown state: "+t),i.forEach(function(t){e.removeAttribute(t)}),e.setAttribute(t,""))}})},function(t,e){AFRAME.registerComponent("avatar-selector",{init:function(){this.onHit=this.onHit.bind(this),this.selectAvatar=this.selectAvatar.bind(this)},play:function(){var t=this.el;t.addEventListener("hit",this.onHit),t.addEventListener("gripclose",this.selectAvatar)},pause:function(){var t=this.el;t.removeEventListener("hit",this.onHit),t.removeEventListener("gripclose",this.selectAvatar)},selectAvatar:function(t){this.hitEl&&(this.el.sceneEl.setAttribute("game-state","selectedAvatar",this.hitEl),this.pause())},onHit:function(t){t.detail.el&&(this.hitEl&&this.hitEl.setAttribute("scale","1 1 1"),this.hitEl=t.detail.el,this.hitEl.setAttribute("scale","2 2 2"))}})},function(t,e){AFRAME.registerComponent("ground",{init:function(){var t,e=this.el.object3D,i="https://cdn.aframe.io/link-traversal/models/ground.json";this.objectLoader||(t=this.objectLoader=new THREE.ObjectLoader,t.crossOrigin="",t.load(i,function(t){t.children.forEach(function(t){t.receiveShadow=!0,t.material.shading=THREE.FlatShading}),e.add(t)}))}})},function(t,e){AFRAME.registerComponent("discofloor",{schema:{pattern:{default:"idle",oneOf:["idle","3","2","1","0"]}},init:function(){this.tiles=[],this.myTick=null,this.step=0,this.bpms={idle:60,3:40,2:40,1:40,0:2400},this.tickTime=6e4/this.bpms[this.data.pattern],this.pat3="0011111001111110011000000111100001111000011000000111111000111110",this.pat2="0011111001111110011000000011000000001100000001100111111001111110",this.pat1="0011000000111000001111000011011000110000001100000011000000110000",this.el.addEventListener("model-loaded",this.initTiles.bind(this))},initTiles:function(t){for(var e=0;e<t.detail.model.children.length;e++)this.tiles[e]=t.detail.model.children[e]},update:function(t){this.tickTime=6e4/this.bpms[this.data.pattern],this.myTick=null,this.step=0,this.animTick()},tick:function(t,e){null===this.myTick&&(this.myTick=t),t-this.myTick>this.tickTime&&(this.myTick=t,this.step++,this.animTick())},animTick:function(){for(var t,e=this.tiles.length,i=3.5,n=0;n<e;n++){var a=Math.floor(n%8),s=Math.floor(n/8);switch(this.data.pattern){case"idle":t=(a+this.step)%2==0;break;case"3":t="1"===this.pat3[n];break;case"2":t="1"===this.pat2[n];break;case"1":t="1"===this.pat1[n];break;case"0":var o=a-i,r=s-i,l=o*o+r*r;t=Math.abs(l-this.step%20)<3}this.tiles[n].visible=t}}})},function(t,e){AFRAME.registerComponent("spotlight",{schema:{color:{default:"#FFFFFF"},speed:{default:{x:1500,y:1400,z:1300}}},init:function(){this.star=null,this.el.addEventListener("model-loaded",this.update.bind(this))},update:function(t){this.speed={x:this.data.speed.x+500*Math.random(),y:this.data.speed.y+500*Math.random(),z:this.data.speed.z+500*Math.random()},this.initialRotation=this.el.getAttribute("rotation");var e=this.el.getObject3D("mesh");if(e.children.length){for(var i=(new THREE.TextureLoader).load(document.getElementById("spotlight-img").getAttribute("src")),n=new THREE.MeshBasicMaterial({shading:THREE.FlatShading,color:this.data.color,transparent:!0,alphaMap:i,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthWrite:!1}),a=0;a<e.children.length;a++)e.children[a].material=n;if(null===this.star){var s=(new THREE.TextureLoader).load(document.getElementById("star-img").getAttribute("src")),o=new THREE.SpriteMaterial({shading:THREE.FlatShading,transparent:!0,map:s,color:this.data.color,blending:THREE.AdditiveBlending,depthWrite:!1});this.star=new THREE.Sprite(o),this.el.setObject3D("star",this.star)}n.needsUpdate=!0}},tick:function(t,e){this.el.setAttribute("rotation",{x:this.initialRotation.x+30*Math.sin(t/this.speed.x),y:this.initialRotation.y,z:this.initialRotation.z+30*Math.sin(t/this.speed.y)}),this.star&&(this.star.material.rotation-=e/3e3)}})},function(t,e){AFRAME.registerComponent("highlighter",{schema:{color:{default:"#fff"},active:{default:!1}},init:function(){var t=this;this.material=null,this.el.addEventListener("model-loaded",function(){var e=t.el.getObject3D("mesh").children[0].material;e.emissiveMap=e.map,t.material=e,t.update()})},update:function(t){this.material&&(t&&this.data.color===t.color&&this.active===t.active||this.material.emissive.set(this.data.active?this.data.color:0))}})},function(t,e){AFRAME.registerComponent("avatar-selection",{init:function(){var t=this.avatarSelectionEl=this.el.querySelector("#avatarSelection");this.avatarEls=this.el.querySelectorAll(".head"),t.setAttribute("visible",!0),this.onKeyDown=this.onKeyDown.bind(this),this.onHover=this.onHover.bind(this),this.onButtonDown=this.onButtonDown.bind(this),this.el.querySelector("#leftSelectionHand").setAttribute("visible",!0),this.el.querySelector("#rightSelectionHand").setAttribute("visible",!0),window.addEventListener("hit",this.onHover),window.addEventListener("buttondown",this.onButtonDown),window.addEventListener("keydown",this.onKeyDown)},onKeyDown:function(t){var e=t.keyCode;e>=49&&e<=52&&this.selectAvatar(this.avatarEls[e-49].parentEl)},onButtonDown:function(t){this.hoveredAvatarEl&&this.selectAvatar(this.hoveredAvatarEl.parentEl)},selectAvatar:function(t){var e=this.el,i=this.selectedAvatarEl=t,n=e.querySelector("#avatarHead"),a=e.querySelector("#leftHand"),s=e.querySelector("#rightHand"),o=e.querySelector("#leftSelectionHand"),r=e.querySelector("#rightSelectionHand");this.el.setAttribute("game-state","selectedAvatar",this.selectedAvatarEl),n.setAttribute("obj-model",{obj:i.querySelector(".head").getAttribute("src"),mtl:i.querySelector(".head").getAttribute("mtl")}),a.setAttribute("obj-model",{obj:i.querySelector(".leftHand").getAttribute("src"),mtl:i.querySelector(".leftHand").getAttribute("mtl")}),s.setAttribute("obj-model",{obj:i.querySelector(".rightHand").getAttribute("src"),mtl:i.querySelector(".rightHand").getAttribute("mtl")}),o.setAttribute("visible",!1),r.setAttribute("visible",!1)},pause:function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("hit",this.onHover),window.removeEventListener("buttondown",this.selectAvatar)},onHover:function(t){this.highlightAvatar(null===t.detail.el?null:t.target)},highlightAvatar:function(t){t&&"head"!==t.className||t===this.hoveredAvatarEl||(null!==t&&t.setAttribute("highlighter",{active:!0}),this.hoveredAvatarEl&&this.hoveredAvatarEl.setAttribute("highlighter",{active:!1}),this.hoveredAvatarEl=t)},remove:function(){this.avatarSelectionEl.setAttribute("visible",!1),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("hit",this.onHover),window.removeEventListener("buttondown",this.commitSelection)}})},function(t,e){AFRAME.registerComponent("collect-url",{init:function(){document.getElementById("floor").setAttribute("discofloor",{pattern:"idle"});var t=this.textElement=document.getElementById("centeredText");t.setAttribute("visible",!0),t.setAttribute("text",{value:"Copy your dance URL",width:3});var e={opacity:0};new AFRAME.TWEEN.Tween(e).to({opacity:1},1e3).onUpdate(function(){t.setAttribute("text",{opacity:e.opacity})}).start();var i={avatar:this.el.getAttribute("game-state").selectedAvatar.id,recording:this.el.components["avatar-recorder"].getJSONData()};this.el.systems.uploadcare.upload(i,"application/json")},remove:function(){this.textElement.setAttribute("visible",!1)}})},function(t,e){AFRAME.registerComponent("countdown",{init:function(){this.countdownTime=this.el.getAttribute("game-state").countdownTime,this.countdown=this.countdown.bind(this),this.interval=window.setInterval(this.countdown,1e3),this.floor=document.getElementById("floor"),this.floor.setAttribute("discofloor",{pattern:""+this.countdownTime});var t=this.textElement=document.getElementById("centeredText");t.setAttribute("visible",!0),t.setAttribute("text",{value:this.countdownTime.toString()}),this.opacity=1},countdown:function(){this.countdownTime--,this.opacity=1,this.textElement.setAttribute("text",{value:this.countdownTime.toString()}),this.el.setAttribute("game-state","countdownTime",this.countdownTime),this.floor.setAttribute("discofloor",{pattern:""+this.countdownTime}),0===this.countdownTime&&window.clearInterval(this.interval)},tick:function(t,e){this.opacity-=.001*e,this.textElement.setAttribute("text",{opacity:this.opacity})},remove:function(){this.textElement.setAttribute("visible",!1)}})},function(t,e){AFRAME.registerComponent("dancing",{init:function(){var t=this.textElement=document.getElementById("centeredText"),e=this.counter0=document.getElementById("counter0"),i=this.counter1=document.getElementById("counter1");this.dancingTime=this.el.getAttribute("game-state").dancingTime,t.setAttribute("visible",!0),t.setAttribute("text",{value:"Dance!",opacity:1});var n={opacity:1};new AFRAME.TWEEN.Tween(n).to({opacity:0},500).delay(300).onUpdate(function(){t.setAttribute("text",{opacity:n.opacity})}).onComplete(function(){t.setAttribute("visible",!1)}).start(),e.setAttribute("text",{value:this.dancingTime.toString()}),i.setAttribute("text",{value:this.dancingTime.toString()}),e.setAttribute("visible",!0),i.setAttribute("visible",!0),this.countdown=this.countdown.bind(this),this.el.components["avatar-recorder"].startRecording(),this.interval=window.setInterval(this.countdown,1e3)},countdown:function(){var t=this.el;this.dancingTime--,this.counter0.setAttribute("text",{value:this.dancingTime.toString()}),this.counter1.setAttribute("text",{value:this.dancingTime.toString()}),0===this.dancingTime&&(window.clearInterval(this.interval),t.querySelector("#leftHand").removeAttribute("tracked-controls"),t.querySelector("#rightHand").removeAttribute("tracked-controls"),t.components["avatar-recorder"].stopRecording()),t.setAttribute("game-state","dancingTime",this.dancingTime)},remove:function(){this.textElement.setAttribute("visible",!1),this.counter0.setAttribute("visible",!1),this.counter1.setAttribute("visible",!1)}})},function(t,e,i){var n=i(2).getUrlParams;i(2).loadJSONFromUrl;AFRAME.registerComponent("intro",{init:function(){var t=n();if(t.url){var e=this;this.el.sceneEl.systems.uploadcare.download(t.url,function(t){var i=document.getElementById(t.content.avatar),n=i.querySelector(".head"),a=i.querySelector(".rightHand"),s=i.querySelector(".leftHand"),o=document.getElementById("avatarHead"),r=document.getElementById("rightHand"),l=document.getElementById("leftHand");e.el.sceneEl.setAttribute("game-state","selectedAvatar",i),o.setAttribute("obj-model",{obj:n.getAttribute("src"),mtl:n.getAttribute("mtl")}),r.setAttribute("obj-model",{obj:a.getAttribute("src"),mtl:a.getAttribute("mtl")}),l.setAttribute("obj-model",{obj:s.getAttribute("src"),mtl:s.getAttribute("mtl")}),e.el.setAttribute("avatar-replayer",{spectatorMode:!0,loop:!0}),e.el.components["avatar-replayer"].startReplaying(t.content.recording)})}else this.el.setAttribute("avatar-replayer",{src:"assets/dance.json",spectatorMode:!0,loop:!0})},remove:function(){this.el.removeAttribute("avatar-replayer")}})}]);